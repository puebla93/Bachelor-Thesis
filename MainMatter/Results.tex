%===================================================================================
% Chapter: Results
%===================================================================================
\chapter{Resultados}\label{chapter:results}
%===================================================================================

En este capítulo se exponen los resultados alcanzados a partir de la obtención de varias escenas de prueba. Primeramente se expondrán los resultados obtenidos en la detección de \textit{Home Plate} y se abordarán los escenarios en que falla esta detección. Luego se expondrá el proceso de confección del conjunto de prueba para la deteción de la pelota. Por último se mostrarán los resultados obtenidos en la detección de la pelota.

Las escenas utilizadas fueron selecionadas de manera tal que fueran comletamente diferentes, puesto que así es posible evaluar el sistema en dos escenarios distintos. Las principales diferencias que presentan estas escenas es en la iluminación de la imagen y la cantidad de ruido que presentan.

\section{Resultados en la detección de \textit{Home Plate}}

Para evaluar el desempeño de los algoritmos que intervienen en la detección de \textit{Home Plate} se analizó el resultado obtenido en cada escena. Estas escenas se seleccionaron de forma tal que incluyeran imágenes con distinta iluminación y distintos niveles de ruido.

En la detección del \textit{Home Plate} que se muestra en la figura \ref{fig:DetectedHomeSEDER} la iluminación en toda la imagen no cambia, esto se debe a que es una escena al aire libre. El hecho de que no haya cambios drásticos en la iluminación conlleva a la obtención de una imagen con poco ruido y una detección de \textit{Home Plate} mucho más precisa.

\begin{figure}[h!]
    \centering
    \begin{subfigure}[b]{0.32\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/HomeSEDER.png}
        \caption{}
    \end{subfigure}
    \begin{subfigure}[b]{0.32\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/DetectedHomeSEDER.png}
        \caption{}
    \end{subfigure}
    \caption{Detección de \textit{Home Plate}. Escena terreno del SEDER : (a) Imagen original, (b)\textit{ Home Plate} detectado.}
    \label{fig:DetectedHomeSEDER}
\end{figure}

Por otra parte en la figura \ref{fig:DetectedHomeMATCOM} el ambiente es más desfavorable con relación al anterior, puesto que la imagen obtenida presenta mayor cantidad de ruido. Este ruido está dado principalmente por el hecho de que el suelo refleja mucha luz y que una mitad de la imagen es un área bajo techo (poca iluminación) y la otra es al aire libre (mayor cantidad de luz), lo que proporciona un cambio de iluminación en la mitad de la imagen.

\begin{figure}[h!]
    \centering
    \begin{subfigure}[b]{0.32\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/HomeMATCOM.png}
        \caption{}
    \end{subfigure}
    \begin{subfigure}[b]{0.32\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/DetectedHomeMATCOM.png}
        \caption{}
    \end{subfigure}
    \caption{Detección de \textit{Home Plate}. Escena pasillo de MATCOM : (a) Imagen original, (b)\textit{ Home Plate} detectado.}
    \label{fig:DetectedHomeMATCOM}
\end{figure}

Uno de los posibles escenarios en la detección del \textit{Home Plate} es en el que la pelota pasa por encima de este o que en el momento de capturar la pelota el guante del receptor (mascota) se interponga entre el \textit{Home} y la cámara, aunque esto es menos probable debido a la ubicación del receptor. En la gran mayoría de los casos en que un objeto se interpone entre la cámara y el \textit{Home}, la detección de este se verá afectada. En este sistema esto no supone un problema, puesto que \textit{Home Plate} es detectado entre lanzamiento y lanzamiento. Luego de cada lanzamiento el sistema dedica un tiempo de alrededor 2 segundos a calibrar la posición del \textit{Home}.

En la figura \ref{fig:WrongHomeBall} se muestra uno de los escenarios donde la pelota se encuentra sobre una de las esquinas del \textit{Home}. Como se puede apreciar el contorno no tiene las características geométricas propias de un \textit{Home Plate}, por lo que este no será detectado por el sistema en este frame.

\begin{figure}[h!]
    \centering
    \begin{subfigure}[b]{0.32\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/HomeWrongBallSEDER.png}
        \caption{}
    \end{subfigure}
    \begin{subfigure}[b]{0.32\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/HomeWrongContourBallSEDER.png}
        \caption{}
    \end{subfigure}\\
    \begin{subfigure}[b]{0.32\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/HomeWrongBallMATCOM.png}
        \caption{}
    \end{subfigure}
    \begin{subfigure}[b]{0.32\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/HomeWrongContourBallMATCOM.png}
        \caption{}
    \end{subfigure}
    \caption{\textit{Home Plate} no detectado a causa de la posición de la pelota : (a) Imagen original SEDER, (b) Contorno detectado SEDER, (c) Imagen original MATCOM, (d) Contorno detectado MATCOM.}
    \label{fig:WrongHomeBall}
\end{figure}

Otro de los posibles escenarios es cuando el guante del receptor se encuentra encima de Home (ver Fig. \ref{fig:WrongHomeGlove}), esto también provoca que el contorno detectado no posea las características geométricas requeridas por el sistema para ser identificado como \textit{Home}.

\begin{figure}[h!]
    \centering
    \begin{subfigure}[b]{0.32\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/HomeWrongGloveSEDER.png}
        \caption{}
    \end{subfigure}
    \begin{subfigure}[b]{0.32\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/HomeWrongContourGloveSEDER.png}
        \caption{}
    \end{subfigure}\\
    \begin{subfigure}[b]{0.32\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/HomeWrongGloveMATCOM.png}
        \caption{}
    \end{subfigure}
    \begin{subfigure}[b]{0.32\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/HomeWrongContourGloveMATCOM.png}
        \caption{}
    \end{subfigure}
    \caption{\textit{Home Plate} no detectado a causa de la posición del guante del receptor : (a) Imagen original SEDER, (b) Contorno detectado SEDER, (c) Imagen original MATCOM, (d) Contorno detectado MATCOM.}
    \label{fig:WrongHomeGlove}
\end{figure}

\section{Obtención del conjunto de prueba}

Para la obtención del conjunto de prueba que medirá los resultados obtenidos en la detección de la pelota, se implementó una herramienta que permite seleccionar manualmente la posición de la misma. Esta selección se lleva a cabo sobre una imagen que no es la tomada por la cámara, sino otra que resulta de transformar la vista de la imagen tomada a \textit{top-view}, utilizando los cinco puntos del \textit{Home Plate} previamente identificados. El proceso de seleccionar manualmente la posición de la pelota se realiza mediante la obtención del rectángulo en el cual se encuentra inscrita. El dato obtenido con esta herramienta es un archivo en formato JSON (ver Fig. \ref{fig:JsonFile}) en el cual las llaves están conformadas por el nombre del frame en donde se encuentra una pelota y los valores son el centro y el radio de dicha pelota. Estos valores son los utilizados posteriormente en la comparación entre los valores de centro y radio brindados por el sistema y los obtenidos con la herramienta implementada.

\begin{figure}[!h]
    \centering
	\includegraphics[width=10cm]{Graphics/JSONFileFormat.png}
    \caption{Archivo JSON generado por la herramienta que conforma el conjunto de prueba.}
    \label{fig:JsonFile}
\end{figure}

Para la obtención de las imágenes que se utilizaron en la generación del conjunto de prueba, se construyó una estructura conformada por dos trípodes de $2.25$ metros de altura y una tabla de $2.20$ metros de largo donde fue colocada la cámara (ver Fig. \ref{fig:Structure}). Esta estructura fue posicionada encima del \textit{Home Plate}, posición seleccionada previamente en la sección \ref{sec:Position}. Los lanzamientos que forman parte del conjunto de prueba fueron realizados en el SEDER.

Las imágenes tomadas poseen diferentes resoluciones como 320x240, 1280x720 y 1920x1080. Las imágenes con resolución de 320x240 fueron tomadas con la cámara del \textit{PlayStation Eye} que es la cámara que usa el sistema. Las resoluciones de 1280x720 y 1920x1080 (\textit{fullHD}) fueron tomadas con el \textit{SmartPhone OnePlus 5T}. Estas imágenes de mayor resolución se tomarón con el objetivo de comparar los resultados obtenidos con la cámara del \textit{PlayStation Eye} que son a una menor resolución.

\begin{figure}[!h]
    \centering
    \includegraphics[width=\linewidth]{Graphics/Structure.jpg}
	\caption{Estructura utilizada en el proceso de obtención las imagenes que se utilizaron en la generación del conjunto de prueba.}
	\label{fig:Structure}
\end{figure}

\section{Resultados en la detección de la pelota}

Para analizar los resultados alcanzados en la detección de la pelota se seleccionaron del conjunto de prueba doce lanzamientos distintos, de los cuales cuatro fueron tomados a una resolución de 320x240, otros cuatro a 1280x720 y los restantes a 1920x1080. Los lanzamientos escogidos poseen diferentes características, lo que permite evaluar el comportamiento del sistema en diferentes tipos de lanzamientos. Los cuatro tipos de lanzamientos seleccionados para cada una de las resoluciones son lanzamientos al centro de \textit{Home Plate}, lanzamientos en la zona alta y lanzamientos a la izquierda y la derecha del \textit{Home Plate}.

Para poder comprender con una mayor claridad los resultados obtenidos, se decidió implementar una herramienta que permitiera dado los lanzamientos seleccionados del conjunto de prueba, graficar en \textit{3D} la posición de la pelota seleccionada manualmente y la posición brindada por el sistema (ver Figs. \ref{fig:PitchesPSEye}, \ref{fig:PitchesSlowMotion} y \ref{fig:PitchesFullHD}). Otra de las funcionalidades que brinda esta herramienta es que permite calcular el error promedio obtenido en cada lanzamiento.
$$error = \frac{1}{n} \sum_{i=1}^n dist(br_i, bs_i)$$
donde $n$ es el número de frames donde aprarece la pelota, $br_i$ es el centro de la pelota selecionado manualmente y $bs_i$ es el centro de la pelota detectado por el sistema.

Para calcular este error primeramente hallamos la distancia entre la posición de la pelota selecionada manualmente y la que nos proporcionó el sistema en cada frame de un lanzamiento, luego las distancias calculadas durante este lanzamiento son promediadas. Los errores obtenidos se pueden observar en la Tabla \ref{table:Errors}.

\begin{figure}[!h]
    \centering
    \begin{subfigure}[b]{0.48\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/PSEye_pitch1.png}
    \end{subfigure}
    \begin{subfigure}[b]{0.48\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/PSEye_pitch2.png}
    \end{subfigure}
    \begin{subfigure}[b]{0.48\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/PSEye_pitch3.png}
    \end{subfigure}
    \begin{subfigure}[b]{0.48\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/PSEye_pitch4.png}
    \end{subfigure}
	\caption{Lanzaminentos tomados con la cámara del \textit{PlayStation Eye} a una resolución de 320x240 a 187$fps$.}
	\label{fig:PitchesPSEye}
\end{figure}

\begin{figure}[!h]
    \centering
    \begin{subfigure}[b]{0.48\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/SlowMotion_pitch1.png}
    \end{subfigure}
    \begin{subfigure}[b]{0.48\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/SlowMotion_pitch2.png}
    \end{subfigure}
    \begin{subfigure}[b]{0.48\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/SlowMotion_pitch3.png}
    \end{subfigure}
    \begin{subfigure}[b]{0.48\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/SlowMotion_pitch4.png}
    \end{subfigure}
	\caption{Lanzaminentos tomados con el \textit{SmartPhone OnePlus 5T} a una resolución de 1280x720 a 120$fps$.}
	\label{fig:PitchesSlowMotion}
\end{figure}

\begin{figure}[!h]
    \centering
    \begin{subfigure}[b]{0.48\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/FullHD_pitch1.png}
    \end{subfigure}
    \begin{subfigure}[b]{0.48\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/FullHD_pitch2.png}
    \end{subfigure}
    \begin{subfigure}[b]{0.48\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/FullHD_pitch3.png}
    \end{subfigure}
    \begin{subfigure}[b]{0.48\linewidth}
        \includegraphics[width=\linewidth]{Graphics/Results/FullHD_pitch4.png}
    \end{subfigure}
	\caption{Lanzaminentos tomados con el \textit{SmartPhone OnePlus 5T} a una resolución de 1920x1080 a 60$fps$.}
	\label{fig:PitchesFullHD}
\end{figure}

\begin{table}[!h]
    \centering
    \begin{tabular}{cccc}
        & 320x240/187$fps$ & 1280x720/120$fps$ & 1920x1080/60$fps$\\\hline
        lanzamiento \# 1 & $4.80px$ & $3.76px$ & $7.60px$\\\hline
        lanzamiento \# 2 & $7.63px$ & $3.75px$ & $4.86px$\\\hline
        lanzamiento \# 3 & $6.53px$ & $3.09px$ & $5.68px$\\\hline
        lanzamiento \# 4 & $3.75px$ & $4.02px$ & $5.37px$
    \end{tabular}
    \caption{Error promedio en la posición de la pelota en cada lanzamiento.}
    \label{table:Errors}
\end{table}
